<header id="mainHeader" class="position-relative py-2 mb-1 px-3 bg-transparent" style="z-index: 9999;">
    <div class="d-flex align-items-center justify-content-between">
        <!-- Logo -->
        <a href="/" class="d-flex align-items-center px-2 text-decoration-none rounded-pill">
            <div class="me-1">
                {% include 'components/plumeIcon.html' %}
            </div>
            <span class="fs-4 text-secondary-emphasis">Plume</span>
        </a>

        <!-- Desktop: Barra de búsqueda y botones -->
        <div class="d-none d-lg-flex align-items-center flex-grow-1 justify-content-between ms-4">
            <!-- Barra de búsqueda -->
            <form class="d-flex mx-auto flex-grow-1 justify-content-center" role="search" 
                  action="" method="get" style="max-width: 400px;">
                <input class="form-control rounded-pill border border-dark-subtle bg-transparent px-3" 
                       type="search" 
                       placeholder="Buscar..." 
                       aria-label="Search" 
                       name="q">
            </form>

            <!-- Carrito y Usuario -->
            <div class="d-flex align-items-center gap-2">
                {% if current_user.is_authenticated %}
                <a href="{{ url_for('shop.cart') }}" class="btn btn-outline-secondary rounded-pill">
                    <i class="bi bi-cart3"></i>
                    <span>Mi Carrito</span>
                </a>
                {% endif %}

                {% if current_user.is_authenticated %}
                <div class="dropdown">
                    <button class="btn btn-outline-secondary rounded-pill dropdown-toggle" type="button" id="userDropdown" data-bs-toggle="dropdown">
                        <i class="bi bi-person-fill"></i>
                        {{ current_user.name }}
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li>
                            <a class="dropdown-item" href="{{ url_for('admin.dashboard') }}">
                                <i class="bi bi-book-half"></i> Mis Libros
                            </a>
                        </li>
                        <li><hr class="dropdown-divider"></li>
                        <li>
                            <a class="dropdown-item" href="{{ url_for('auth.logout') }}">
                                <i class="bi bi-door-open"></i> Cerrar Sesión
                            </a>
                        </li>
                    </ul>
                </div>
                {% else %}
                <a href="{{ url_for('auth.login') }}" class="btn btn-outline-secondary rounded-pill">
                    Iniciar Sesión
                </a>
                {% endif %}
            </div>
        </div>

        <!-- Mobile: Botón hamburguesa -->
        <button class="navbar-toggler d-lg-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent">
            <span class="navbar-toggler-icon"></span>
        </button>
    </div>

    <!-- Mobile: Menú colapsable -->
    <div class="collapse d-lg-none mt-3" id="navbarContent">
        <form class="d-flex mb-3" role="search" action="" method="get">
            <input class="form-control rounded-pill border border-dark-subtle bg-transparent px-3" 
                   type="search" 
                   placeholder="Buscar..." 
                   name="q">
        </form>

        <div class="d-flex flex-column gap-2">
            {% if current_user.is_authenticated %}
            <a href="{{ url_for('shop.cart') }}" class="btn btn-outline-secondary rounded-pill w-100">
                <i class="bi bi-cart3"></i> Mi Carrito
            </a>
            <a href="{{ url_for('admin.dashboard') }}" class="btn btn-outline-secondary rounded-pill w-100">
                <i class="bi bi-book-half"></i> Mis Libros
            </a>
            <a href="{{ url_for('auth.logout') }}" class="btn btn-outline-secondary rounded-pill w-100">
                <i class="bi bi-door-open"></i> Cerrar Sesión
            </a>
            {% else %}
            <a href="{{ url_for('auth.login') }}" class="btn btn-outline-secondary rounded-pill w-100">
                Iniciar Sesión
            </a>
            {% endif %}
        </div>
    </div>
</header>

<style>
    #mainHeader {
        top: 0;
        z-index: 1000;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        transition: background-color 0.3s ease, box-shadow 0.3s ease;
    }
    
    #mainHeader.sticky {
        position: sticky !important;
        background-color: white !important;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.25);
    }

    .form-control::placeholder {
        color: rgba(0, 0, 0, 0.5);
    }

    .btn-outline-secondary {
        border-color: rgba(0, 0, 0, 0.2);
        color: rgba(0, 0, 0, 0.7);
        transition: all 0.3s ease;
    }

    .btn-outline-secondary:hover {
        background-color: rgba(0, 0, 0, 0.05);
        border-color: rgba(0, 0, 0, 0.3);
        color: rgba(0, 0, 0, 0.9);
    }

    /* Estilo del botón hamburguesa */
    .navbar-toggler {
        padding: 0.5rem;
        background-color: transparent;
    }

    .navbar-toggler:focus {
        box-shadow: none;
    }

    .navbar-toggler-icon {
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3e%3cpath stroke='rgba(0, 0, 0, 0.7)' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e");
        width: 1.5rem;
        height: 1.5rem;
        display: inline-block;
    }

    /* Animación suave del collapse */
    .collapse {
        transition: height 0.3s ease;
    }

    /* Ajustes para móvil */
    @media (max-width: 991.98px) {
        #navbarContent {
            background-color: white;
            border-radius: 12px;
            padding: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
    }
</style>

<script>
    const header = document.getElementById('mainHeader');
    const headerOffset = header.offsetTop;

    window.addEventListener('scroll', function() {
        if (window.pageYOffset > headerOffset) {
            header.classList.add('sticky');
        } else {
            header.classList.remove('sticky');
        }
    });
</script>